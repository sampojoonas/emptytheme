# CMSとは？

CMSとは、Content Management System (コンテンツ管理システム)の略です。webサイトを簡単に管理・更新できるシステムのことです。


# Wordpressとは？

WordPress(ワードプレス)は2003に公開されたCMSの一種で、ブログ型で世界で最も利用されているオープンソースCMSです。（世界中のwebサイトの約30%を占めている。※2019年現在）
近年では、ブログ以外のサイトにもよく使われるようになりました。
（会社のホームページ、不動産屋さんの管理システム、ECサイトのプラットフォームなどなど）
コミュニティも活発で、テーマや無料のプラグインが大量に提供されています。

* wordpress.org - 公式サイト

(wordpress.comという有料ホスティングサービスもありますが、wordpress.orgとの関係がありません。)

## WordPressを導入メリット/デメリット

### :o: メリット
* 無料である。
* 無料プラグイン（拡張機能）が豊富。
* 拡張性と自由度がある。
* 日本語ドキュメントが多い。
* お客様自身で情報を発信することが可能になるので、有益な情報を蓄積でき、ブランディング（またはメディア）として成立させることができる。
* 運営時には、FTP（ファイルアップロードソフト）なしで、スマホからでも、他人のデバイスからでも更新ができる。


### :x: デメリット
* 拡張性と自由度が高いので、こだわればこだわるだけ管理が大変に。

※ユーザーとコミュニケーションを取りたい！情報をいち早く届けたい！
という目的だけであれば、SNSを利用することの方が手軽かもしれません。


#### 向いているお客様
* ユーザーに情報を定期的に提供する必要があるお客様
* サイトの更新頻度が高いお客様

#### 向いていないお客様
* サイトを更新しないお客様
* 無料もしくは格安でWebサイトを制作し、運用したいお客様


## WordPressを実行する要件 :computer:
WordPressはPHPプログラムで制作されています。
WordPressを実行するコンピューターには、下記の要件を満たさないと動きません。

* PHP 7.3 以上
* MySQL 5.6 以上、または MariaDB 10.0 以上
* Nginx または mod_rewrite モジュールありの Apache
* HTTPS 対応

さくらインターネット、ロリポップ、エックスサーバーなど人気レンタルサーバーのほとんどは上記の要件を満たしていますが、自分のパソコンで開発しようとしたら、困るところが多いです。

[参考：要件 (WordPress公式サイト)](https://ja.wordpress.org/about/requirements/)



# 自分のPCでWordPressを動かす開発環境を作る

## 開発環境の立ち上げ / Local by Flywheel
自分のパソコンでWordPress開発をするのに開発環境が必要です。

開発環境というのは、簡単に言うと、開発に使われているソフト(エディター、)のことです。



### データベースって何？ :bank:

```
「データベース（英: database, DB）とは、検索や蓄積が容易にできるよう整理された情報の集まり。」 - Wikipedia
```


構造としてデータベースはエクセルファイルに似ているものとして覚えておいても大丈夫です。ただし、データベースに入れるデータの形式などが前もって決まっています。

DBサーバーに動いているデータベースファイルを直接に触ることはほぼありません。


htmlとcssで作成されている静的なサイトの内容はすべて直接にコードの中に書きますが、WordPressのような動的なサイトでは、内容のほとんどはデータベースに保存されます。

自分のパソコンでWordPressサイトを開発するには、ウェブサーバーとデータベースサーバーが必要ですが、それを自分でインストールしたり設定したりするのはかなり難しいので、それを開発者の代わりにしてくれるソフトがよく開発されています。

WampServer, MAMP, XAMPPなどソフトがいくつかありますが、今回使うのはLocal by Flywireというソフトです。

Local by Flywireは、WordPress開発のために作られたソフトなので、かなり使いやすい。

"Is this site Multisite?"は"No"にします。

サーバーが立ち上がったら、ウィンドウの右上にあるDEVMODEスイッチをONにしましょう。DEVMODEを有効にすると、キャッシュが無効になります。

### 要するに
* WordPressを実行するため、ウェブサーバーとデータベースサーバーが必要です。
* Local by FlywireにWordPressに必要なすべてが入っています。

# 実践！

管理画面を使って見ましょう！

### 管理画面を日本語にする方法
管理画面を日本語にする方法: `Settings` → `General` → `Site language` → `日本語`


## プラグイン :package:

プラグインとは、WordPressに追加できる拡張機能のことです。
* セキュリティ
* 画像処理
* 連絡フォーム
* SEO (検索エンジン最適化)
* バックアップ
* などなど

### プラグインの注意点

* レビューは十分に高いですか？
* 最近更新されましたか？
* 開発者はウェブサイトなど持っていますか？

ある程度の信頼性がないとインストールしない方がいいです。

プラグインが多いほどサイトが遅くなる傾向があり、セキュリティ上の問題も招きますので、プラグインごとに十分な検討を勧めます。

### おすすめプラグイン
* All-in-One WP Migration　（バックアップはサイト移動に便利なプラグイン）
* Show Current Template (編集中のテンプレを表示する)

-----

# WordPressのテーマ開発の基本

## はじめに

### よくある用語

* **サイト** -　ウェブページを構築しているシステム全体のこと
* **ウェブページ** - ウェブブラウザで閲覧可能な、ページ単位の文書のことです。
* **キャッシュ(cache)** - **ブラウザーとサーバー**が持っている**ストレージ**のことです。
* **ウェブサーバー** - ウェブサイトを表示するためのコンテンツの置き場所。
* **コンテンツ** - スクリプト（PHPなど）、画像、htmlなど。
* **スクリプト** -　PHPのような開発言語で動的にサイトを表示したいときに利用する
* **動的** - ウェブサイトにおいてユーザーがアクセスするたびにスクリプトによって生成されるページを意味します。
* **静的** - サーバ上にあらかじめ存在し、そのままの形で表示されるウェブページを指します。


## まず知っておきたいこと
プログラマーではない限り、完全に書けなくても大丈夫です！
コピペしても構いませんが、スクリプトの機能をなんとなくでも読めると問題が解決できます。

-----

## :beginner: PHPについてのひとこと
PHPとは、ウェブ開発のために作られたプログラミング言語です。HTMLファイルと違って、PHPファイルをそのままフォルダーからブラウザーへドラック＆ドロップをしても何も表示されません。なぜかというと、PHPファイルを表示するには、PHP対応があるウェブサーバーが必要です。レンタルサーバーのほとんどでPHPが使えるので、FTPソフトでPHPファイルをサーバーにアップロードして、サイトにアクセスしたらそのファイルを問題なく見えます。

Local by FlywheelにPHP対応ウェブサーバーが付いていますので、自分のパソコンでもPHPファイルを見ることができます。


### 1. PHPファイルの特徴？

PHPの機能を利用するのにPHP専用の開始タグの `<?php` と終了タグの `?>` が必要です。PHPタグを入れないと、PHPコードはそのまま書き出されてしまいます。あと、終了タグを入れないと逆にコードが書き出されなくなる場合があります。

PHPファイルの中身はHTMLコードだけでも大丈夫です。

本気でWPテーマを作ろうと思っていたら、PHPの基礎を覚えた方が良いです。

### 2. よく使用されている

#### 関数 (function)
PHPコードを見てみると、英文字とそのあとに付いている括弧がよく見えます。

関数の例
```php
get_header();
```

1. 括弧がついているコードは関数(function)といいます。関数は、何か前もって決めた処理を実行する。
2. 括弧の中に、関数に必要な情報を入れることができます。

※同じ機能を何回も使用したい場合は、関数化しておくと便利！

#### コメント

コメントは、読みやすくするために、コードの実行に影響を及ばさないメモを書き残すこと。HTMLコメントと違って、PHPコメントはブラウザーのソースコードで見ることができません。PHPには、コメントが３つの種類があります：


```
// 1. 一行コメント

# 2. 一行コメント

/*
3. 複数行コメント
複数行コメント
複数行コメント
*/
```

### 4. エラーが出たときの対処方法
コンテンツが切れていたり、真っ白で何も表示されないときにチェックする方法です。

* とりあえず戻す。「ctrl + z」をしてみて表示されるか確認する。
* PHPの部分を全てコメントアウトして表示する。すこしずつ表示させて、どこで真っ白になるか検証する。
* 場所の特定ができたらコードに間違いがないかチェックする。
　* 全角スペースが入っていないか。（エディター(Visual Studio Code, Atom, Sublime Textなど）のスペースと改行を表示させる。）
　* PHP開始タグと終了タグのをどちらかが抜けていないかチェック。

※PHPのエラーが読めれば簡単に解決できるかも。エラーの内容をgoogle先生にそのまま貼り付けるとだいたい解決する。w


### 5. PHPが初めての方へのポイント
1. バックアップを頻繁に取ること
2. ホワイトスペースを確認すること
3. 自分のための雛型を用意する
4. **バックアップを頻繁に取ること**

### 要するに

* PHPを実行するにはサーバーソフトが必要です。
* HTMLコードしか書いていないPHPファイルがある。その一方で、HTMLコードを書き出さないPHPファイルもある。
* PHPはサーバーが必要ですので、PHPファイルをフォルダーからブラウザーにドラッグ＆ドロップするだけでは何も起こらない。
* 簡単なWPテーマ開発は、PHPが書けなくても大丈夫ですが、なんとなく読めればデバッグができる。

-----

## :wrench: テーマ開発

### よくある用語
* **テーマフォルダー**： WordPressがインストールされたフォルダー（`/wp-contents/themes/`）の中にあるフォルダーのこと
* **テーマ機能**： テーマによって使えたり使えなかったりするWordPressの機能。例えば、メニュー、アイキャッチ画像など

### 1. テーマって何？
テーマという言葉には意味が多いが、ウェブやアプリ業界では、たいてい「見た目」という意味として使われています。WordPressもそうですが、見た目だけではなく、WordPressのテーマの場合は、サイトで使える機能も付いています。

WordPressサイトにアクセスするときに、読み込まれるページはテーマフォルダーの中にある`index.php`から読み込まれます。

例えば、`iikane`というテーマを`wp-content/themes/iikane/`というフォルダーに入れます。これはテーマフォルダーと言います。


WordPressをインストールすると`wp-content/themes/`にすでに３つのテーマが入っています。

||twentynineteen(2019)|twentyseventeen(2017)|twentysixteen(2016)|
|-|---|--|---|
|**ヘッダー画像**|×|○|○|
|**背景画像**|×|×|○|
|**カラー**|○|○|○|

[参考：テーマ機能 (WordPress公式サイト)](https://wpdocs.osdn.jp/%E3%83%86%E3%83%BC%E3%83%9E%E6%A9%9F%E8%83%BD)

#### 要するに
* テーマがないとWordPressサイトが動かない
* テーマは`wp-content/themes/`フォルダーの中にある


### 2. 必要なファイル

残念ながら、テーマフォルダーを作成しても、そのままではWordPressの管理画面で表示されません。最低限、中に`index.php`と`style.css`の２つのファイルを作らないといけません。
* style.css (*) - (テーマ情報が入るファイル)
* index.php (*) - 一覧(トップページ)
* header.php - ヘッダーの部分
* footer.php - フッターの部分
* functions.php - テーマの機能を決めるファイル
* single.php - 投稿の雛形
* page.php - 固定ページの雛形

(*) が付いているファイルがないとテーマが有効にできません。

#### style.cssについて
テーマフォルダーの直下に置くstyle.cssに、テーマについての情報を記します。もし公開したり売ったりしたりする予定がなかったら、全部書かなくても大丈夫です。

```
/*
Theme Name: iikane　
Theme URI: https://iikanetheme.com
Author: 姓名・ツイッターなどなど
Author URI: https://themes123123123123.com
Description: iikane paletteのウェブサイトのために作成されたテーマです。
Version: 1.0
*/
```
自分のWPテーマを売ったり、WordPressのテーマディレクトリで公開したりしたい場合は、上記の行だけではなく、ライセンスなど情報をちゃんと入れないといけません。複数のサイトで使われないテーマなら上記の情報だけで十分です。

[参考：テーマスタイルシートの詳細 (WordPress公式サイト)](https://wpdocs.osdn.jp/%E3%83%86%E3%83%BC%E3%83%9E%E3%81%AE%E4%BD%9C%E6%88%90#.E3.83.86.E3.83.BC.E3.83.9E.E3.82.B9.E3.82.BF.E3.82.A4.E3.83.AB.E3.82.B7.E3.83.BC.E3.83.88)

#### index.php
`index.php`は簡単にいうと、`index.html`のようなファイルですが、`index.html`と違って、動的なコンテンツが表示できます。

`<?php get_header(); ?>`を入れると、header.phpの中身が埋め込まれます。

`<?php get_footer(); ?>`上記と同様に、footer.phpが表示されます。

##### header.php
htmlファイルをテーマにするときに、`header.php`の内容は`<!DOCTYPE html>`からメインコンテンツの開始タグまでの部分です。

headの終了タグ`</head>`の直前に`<?php wp_head(); ?>`を入れます。

##### footer.php
メインコンテンツの終了タグから`</html>`までのコード。

bodyの終了タグ`</body>`の直前に`<?php wp_footer(); ?>`を入れるとWPは自動的に

#### :exclamation: 落とし穴
* `index.php`の拡張子はhtmlになったら正しく動きません。
* `header.php`の中に置く関数は`wp_header();`ではなく`wp_head();`です。
* `footer.php`に`wp_footer();`を入れないとアドミンバーが出てこない。

### 3. functions.phpについて
`functions.php`は厳密にいうとテーマには必要ではないが、ないとほとんど何もできません。
functions.phpの中では、次のようなことが設定出来ます：
* cssとjsファイルの登録(読み込み)
* テーマ機能の追加
* 投稿タイプの追加や編集
* WPの既存機能の変更

#### CSSスタイルシートの登録
様々なプラグインやテーマのCSSファイルが競合しないように、CSSファイルは`functions.php`で登録する必要があります。
`header.php`に`get_head()`関数を入れて、`functions.php`に以下のスクリプトを入れると、WPは自動的にそれをヘッダーに書き出します。
(スタイル(css)とスクリプト(js)の登録の仕方はほぼ一緒なので、混同する可能性があるので注意。)

```php
wp_enqueue_style('main-css', get_template_directory_uri() . '/css/main.css', false, '1.0', 'all');
```
PHPは半角スペースと改行を無視するので、以下のような書き方も可能です。
（どちらのスクリプト`wp_enqueue_style`も同じことを意味します。）
```php
function iikane_theme_scripts() {
    
    // スタイル
    wp_enqueue_style(
        'main-css', # 1. スタイルの名前
        get_template_directory_uri() . '/css/main.css', # 2. スタイルのパス
        false, # 3. 依存のファイル
        '1.0', # 4. バージョン
        'all' # 5. media属性
    );
    
    // スクリプト
    // この後に入れます！※
}
add_action( 'wp_enqueue_scripts', 'iikane_theme_scripts' );
```

スクリプトを登録するときに、ファイルのパスだけではなく、様々な情報とともに登録します。

1. スクリプトの名前。適当に名付けても大丈夫ですが、他のスクリプトと衝突しないよう、接頭語を入れるのをおすすめします。
2. ファイルのパスです。`get_template_directory_uri()`はテーマフォルダーを示す。
3. 2が依存しているスクリプトの名前が入ります(基本的にfalseにします)
4. バージョン番号。変更すると、ファイルの最新バージョンが強制的に読み込まれます。
5. スタイルのmedia属性（‘all’, ‘screen’, ‘print’ or ‘handheld.’のいずれか。ほぼ’all’）。


#### JavaScriptファイルの登録
```
wp_enqueue_script('script-name', get_template_directory_uri() . '/js/example.js', array(), '1.0.0', true);

```
スタイルと同様に、分割して解析してみましょう。
```php
wp_enqueue_script(
'main-js', # 1, スクリプトの名前
get_template_directory_uri() . '/js/example.js', # 2. スクリプトのパス
array(), # 3. 依存スクリプト
'1.0.0', # 4. バージョン
true # 5. スクリプトをフッターに置く
);
```

1. スクリプトの名前 (*)
2. スクリプトのパス (*)
3. スクリプトの依存ファイルの名前 (*)
4. スクリプトのバージョン。値を変えれば強制的に読み込ませられます。(*)
5. スクリプトをフッターに置くかどうか。読み込みを早くするため、普通はtrueにします。trueにされたときに、スクリプトは?`wp_footer()`の箇所に書き出されます。falseの場合は`wp_head()`内に書き出されます。

(*) スタイル設定時`wp_enqueue_style`と同様の意味

ウェブ開発によく使われるjQueryはWordPressにデフォルトに入っていますので、登録する必要はありません。

#### :exclamation: 落とし穴
* functions.phpの中に開始タグ`<?php`がないと動かないので注意。

## メニューを作成する方法
メニューはWordPressのテーマ機能の一種です。メニューを表示させるには３つのステップが必要です。

### メニューを登録する方法

1. functions.phpの中でメニューを使いますよ！と宣言する
2. テーマの中で実際にメニューが表示される場所を指定する
3. 管理画面からもメニューの位置を指定する

#### 1. functions.phpの中でメニューを使いますよ！と宣言する
functions.php:
```
function register_menus() {
  register_nav_menus(
      array(
        'header-menu-location' => __( 'ヘッダーメニュー位置' ),
        'footer-menu-location' => __( 'フッターメニュー位置' )
      )
  );
}
add_action( 'init', 'register_menus' );
```
上記のコードでメニュー機能を有効にして、２つのメニュータイプ（ヘッダーメニューとフッターメニュー）を登録する

#### 2. テーマの中でメニューの位置を指定する
header.php:
```
<?php wp_nav_menu( array( 'theme_location' => 'header-menu-location' ) ); ?>
```
footer.php:
```
<?php wp_nav_menu( array( 'theme_location' => 'footer-menu-location' ) ); ?>
```
上記のコードで、メニューの箇所が指定できる。

[参考：wp_nav_menuの説明 (WordPress公式サイト)](https://wpdocs.osdn.jp/%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%BF%E3%82%B0/wp_nav_menu)

#### 3. 管理画面からもメニューの位置を指定する
管理画面の`外観` → `メニュー`に移動して、新しいメニューを作る


#### :exclamation: 落とし穴
* 管理画面のメニューの保存ボタンを押さないと変更が反映されない
* ユーザーがメニューを作成していないときに、WordPressは固定ページからメニューを自動的に生成して表示する。

### ループ (The Loop)

ループとは、WordPressに登録されたデータ（投稿か固定ページとして）を表示する機能です。

`index.php` - 投稿一覧を表示するファイル
`single.php` - 投稿ページを表示するファイル
`page.php` - 固定ページを表示するファイル

上記の３つのページは、たいてい同じヘッダーとフッターを含んでいます。


WordPressが投稿を決まった形式に書き出す機能はループ(The Loop)と呼びます。

PHPを少し触ったことがある方にも少し読みにくいと思います。

index.phpの中に以下のコードを入れれば、「投稿一覧が書き出されます。

```
<?php if ( have_posts() ) : while ( have_posts() ) : the_post(); ?>

    // 内容はここ！

<?php endwhile; endif; ?>
```



#### ループの中で使える関数

* `the_title()` - 投稿か固定ページのタイトル
* `the_content()` - コンテンツの部分
* `the_permalink()` - 投稿か固定ページへのリンク
* `echo get_the_date('', $post->ID)` - 公開時
* `the_post_thumbnail` - アイキャッチ画像

例 1）`<h2><?php the_title(); ?></h2>`
例 2）`<a href="<?php the_permalink(); ?>"><?php the_title(); ?></a>`
例 3）`<p><?php echo get_the_date('', $post->ID); ?> - <?php the_content() ?></p>`

上記の公開時の書き方は少し特別なので注意が必要です。
なぜなら、同じ日付の記事があるときに、その日付の内容は一つだけしか書き出されないためです。


